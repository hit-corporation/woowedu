!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).PaginationSystem=e()}(this,(function(){"use strict";class t extends class extends class{constructor(){this.events={}}subscribe(t,e){this.events[t]=e}unsubscribe(t){if(this.events[t]){const{[t]:e,...s}=this.events;this.events=s}}fire(t,...e){const s=this.events[t];if(s)return s(...e)}}{constructor(t){if(super(),!(t.container instanceof HTMLElement))throw new Error("`pagingContainer` property is not HTMLElement!");this.container=t.container,this.perPage=t.perPage||10,this.countRecords=t.countRecords??null,this.initCountRecords=this.countRecords,this.isShowPerPage=t.isShowPerPage??!0,this.textShowMore=t.textShowMore??"show more",this.numPage=1,this.activeBtns=[];this.loading=["auto","more","none"].includes(t.loading)?t.loading:"none",this.statusBoxSelector=".dg-status-box",this.pagingBoxSelector=".dg-paging",this.perPageSelector="#per-page",this.paginatorSelector=".pagination",this.showMoreSelector=".show-more",this.template=function(){function t(t,s=10,i=!0){const r=e(1,t);let n=[`<select id="per-page" class="dg-per-page${i?"":" per-page-hide"}">`];return[5,10,15,20,30,40,50].forEach((t=>{const e=t===s?" selected":"";n=[...n,`<option value="${t}"${e}>${t}</option>`]})),n=[...n,"</select>"].join(""),`<div class="dg-status-box"><div class="dg-paging">${n}<div class="pagination">${r}</div></div>`}function e(t=1,e,i=!1){let r=`<div id="number-pages" class="dg-number-pages">${s(t,e).join("")}</div>`;if(e>1){r=`${`<button type="button" ${i?"":"disabled"} data-index="first">&laquo;</button>`}${`<button type="button" ${i?"":"disabled"} data-index="prev">&lsaquo;</button>`}${r}${`<button type="button" ${t===e?"disabled":""} data-index="next">&rsaquo;</button>`}${`<button type="button" ${t===e?"disabled":""} data-index="last">&raquo;</button>`}`}return r}function s(t,e){const s=2,a=2*s;let o=[];return o=e<10?[...o,...i(1,e+1)]:t<a+1?[...o,...i(1,a+4),...n(e)]:t>e-a?[...o,...r(1),...i(e-a-2,e+1)]:[...o,...r(1),...i(t-s,t+s+1),...n(e)],o}function i(t,e){let s=[];for(let i=t;i<e;i++)s.push(`<button type="button" tabindex="${i}" data-index="${i}">${i}</button>`);return s}function r(t){let e=[];return e.push(`<button type="button" tabindex="${t}" data-index="${t}">${t}</button>`),e.push('<button type="button" data-index="disabled" disabled>...</button>'),e}function n(t){let e=[];return e.push('<button type="button" data-index="disabled" disabled>...</button>'),e.push(`<button type = "button" tabindex = "${t}" data-index="${t}" >${t}</button >`),e}function a(t=""){return`<div class="show-more"><i class="show-more-icon" aria-hidden="true"></i> <span>${t}</span></div>`}return{htmlTemplate:t,htmlBtns:e,showMoreTemplate:a}}()}initPaging(){this.setNumberPages(),this.displayTemplatePages(),this.visiblePagingBox()}setNumberPages(){this.numberPages=Math.ceil(this.countRecords/this.perPage)}recalculateNumberPages(t=1){this.countRecords=t,this.setNumberPages()}displayTemplatePages(){this.container.querySelector(this.statusBoxSelector)&&this.container.querySelector(this.statusBoxSelector).remove(),this.container.insertAdjacentHTML("beforeend",this.template.htmlTemplate(this.numberPages,this.perPage,this.isShowPerPage)),this.pagingBox=this.container.querySelector(this.pagingBoxSelector),this.perPageElement=this.container.querySelector(this.perPageSelector),this.paginatorElement=this.container.querySelector(this.paginatorSelector)}render(){this.numberPages>1?(this.displayBtns(),this.visiblePaging(!0)):this.paginatorElement.innerHTML="",this.setActivePageBtn()}displayBtns(){this.paginatorElement.innerHTML=this.template.htmlBtns(this.numPage,this.numberPages,!(1===this.numPage||this.activeBtns.length&&1===this.activeBtns[0]))}visiblePagingBox(){this.numberPages>1&&(this.visiblePaging(!0),this.setActivePageBtn())}visiblePaging(t){this.pagingBox.style.visibility=t||this.numberPages>1?"visible":"hidden"}setActivePageBtn(){if(this.numberPages>1){const t=this.container.querySelector(`[data-index="${this.numPage}"]`);t&&t.classList.add("active","current"),this.activeBtns.length&&this.activeBtns.forEach((t=>{const e=this.paginatorElement.querySelector(`[data-index="${t}"]`);e&&e.classList.add("active")}))}}clearActiveBtns(){this.activeBtns=[]}}{constructor(t){super(t)}init(){return 0===this.countRecords?Promise.resolve():this.renderPages().then((t=>{this.initPaging(),this.setLoadingDependencies(),this.setEvent(),this.renderPagination(t)}))}setLoadingDependencies(){this.showMoreElement&&this.visibileShowMoreBtn(!1),"auto"===this.loading?this.setInfiniteObserver():"more"===this.loading&&(this.showMoreElement||this.setShowMoreBtn(),this.visibileShowMoreBtn(!0))}setInfiniteObserver(){this.infiniteObserver=new IntersectionObserver((([t],e)=>{t.isIntersecting&&(e.unobserve(t.target),this.handlerShowMore())}),{threshold:.8})}setEvent(){this.setPerPageEvent(),this.setPaginationEvent(),this.setShowMoreEvent()}setPerPageEvent(){this.perPageElement&&this.perPageElement.addEventListener("change",this.handlerPerPage.bind(this),!1)}setPaginationEvent(){this.paginatorElement&&this.paginatorElement.addEventListener("click",this.handlerGoPage.bind(this),!1)}setShowMoreEvent(){this.showMoreElement&&"true"!==this.showMoreElement.getAttribute("listener")&&(this.showMoreElement.setAttribute("listener","true"),this.showMoreElement.addEventListener("click",this.handlerShowMore.bind(this),!1))}handlerPerPage(t){const e=t.target;e.blur(),this.perPage=+e.value,this.eventName="perPage",this.numPage=1,this.clearActiveBtns(),this.setNumberPages(),this.renderPages().then((t=>{this.renderPagination(t)}))}handlerGoPage(t){this.eventName="goPage";const e=t.target.dataset.index;if(!e)return!1;switch(e){case"prev":this.activeBtns.length&&this.activeBtns[0]>1?this.numPage=this.activeBtns[0]-1:this.numPage--;break;case"next":this.numPage++;break;case"first":this.numPage=1;break;case"last":this.numPage=this.numberPages;break;default:this.numPage=+e}this.clearActiveBtns(),this.renderData(!1)}handlerShowMore(t){this.eventName=t?"showMore":"moreAuto",this.numPage!==this.numberPages&&(this.clearActiveBtns(),this.numPage<this.numberPages&&(this.paginatorElement.querySelectorAll("button.active").forEach((t=>{this.activeBtns.push(+t.dataset.index)})),this.numPage++,this.renderData(!0)))}renderPages(){return this.fire("renderPages",this.perPage,this.numPage)}renderDataPagination(){return this.renderPages().then((t=>{this.renderPagination(t)}))}renderData(t){this.fire("renderData",this.numPage,t).then((t=>{this.renderPagination(t)}))}renderPagination({lastChild:t,countRecords:e=null}){"auto"===this.loading&&this.observe(t),this.checkScroll(),Number.isFinite(e)&&this.countRecords!==e&&this.recalculateNumberPages(e),this.render()}checkScroll(){["goPage","perPage"].includes(this.eventName)&&(this.fire("goToTop",this.perPage,this.numPage),this.eventName="none")}observe(t){t instanceof HTMLElement?(this.lastChild=t,this.observeLastChild()):console.error("autoload is not possible, last child of collection is not HTMLElement!")}observeLastChild(){this.infiniteObserver&&this.lastChild&&this.infiniteObserver.observe(this.lastChild)}setShowMoreBtn(){this.showMoreElement||(this.displayShowMoreBtn(),this.visibileShowMoreBtn(!1))}displayShowMoreBtn(){this.pagingBox.insertAdjacentHTML("afterend",this.template.showMoreTemplate(this.textShowMore)),this.showMoreElement=this.container.querySelector(this.showMoreSelector)}visibileShowMoreBtn(t){this.showMoreElement.style.display=t?"flex":"none"}}const e=t=>{const e=t.toString().replace(/(\$|\.)/gi,"");return isNaN(t)&&isNaN(e)||"boolean"==typeof t?isNaN(Date.parse(t))?"alpha":"date":"numeric"},s=(t,e="alpha")=>{if(!t)return;const s=(t=t.toString()).toLowerCase();switch(e){case"numeric":t=parseFloat(t.replace(/\$/,"")),t=isNaN(t)?s:t;break;case"date":t=Date.parse(t),t=isNaN(t)?s:t;break;default:t=s}return t},i=(t,e,{field:i,direction:r=1,type:n="alpha"})=>{const a=s(t[i],n),o=s(e[i],n);return a<o?-r:a>o?r:0},r=t=>{try{return new URL(t),!0}catch(t){return!1}},n=(t=[],e=[],s)=>t.forEach((t=>{e.forEach((e=>{if(void 0!==t[e])switch(s){case"json":t[e]=JSON.stringify(t[e],void 0,2);break;case"url":t[e]=`<a class="custom-link" title="${t[e]}" href="${t[e]}">${t[e]}</a>`;break;case"boolean":t[e]=`<label class="custom-checkbox">\n            <input type="checkbox" ${t[e]?"checked":" "}></label>`}}))})),a=(t,i)=>{if(!i.value)return!1;const r=e(t);return"date"===r&&(t=(t=>{const e=new Date(t);let s=""+(e.getMonth()+1),i=""+e.getDate(),r=e.getFullYear();return s.length<2&&(s="0"+s),i.length<2&&(i="0"+i),[r,s,i].join("-")})(t)),t=s(t,r),Array.isArray(i.value)?2===i.value.length&&o[i.action](t,s(i.value[0],r),s(i.value[1],r)):o[i.action](t,s(i.value,r))},o={eq:(t,e)=>t===e,ne:(t,e)=>t!==e,lt:(t,e)=>t<e,lte:(t,e)=>t<=e,gt:(t,e)=>t>e,gte:(t,e)=>t>=e,in_range:(t,e,s)=>t>=e&&t<=s,contains:(t,e)=>t.includes(e),not_contains:(t,e)=>!t.includes(e),starts_with:(t,e)=>t.startsWith(e),ends_with:(t,e)=>t.endsWith(e)};class h{constructor(t){if(!(t.container instanceof HTMLElement))throw new Error("`dataContainer` property is not HTMLElement!");if("function"!=typeof t.dataRenderFn)throw new Error("`dataRenderFn` property is not a Function!");this.container=t.container,this.dataRenderFn=t.dataRenderFn,this.childSelector=t.childSelector||null}renderPages(){throw new Error("`renderPages` method should be implemented in the child class")}renderData(){throw new Error("`renderData` method should be implemented in the child class")}setDataKeys(t={}){const s=Object.keys(t);let i=[],n=[],a=[],o=[];for(const h of s){const s={},l=t[h];"object"==typeof l&&n.push(h),r(l)&&a.push(h),"boolean"==typeof l&&o.push(h);const d=e(l);s.name=h,s.type=d,s.title=h.split(/(?:_|-)/gi).join(" "),i=[...i,s]}this.dataKeys=i,n.length&&(this.jsonFields=n),a.length&&(this.urlFields=a),o.length&&(this.boolFields=o)}checkContent(t){this.jsonFields&&n(t,this.jsonFields,"json"),this.urlFields&&n(t,this.urlFields,"url"),this.boolFields&&n(t,this.boolFields,"boolean")}getLastChild(){return this.container.querySelector(`${this.childSelector}:last-child`)}goToTop(){this.container.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}}class l extends h{constructor({data:t,...e}){if(super(e),!Array.isArray(t))throw new Error("data is not an array!");this.data=t,this.data.length&&(this.setDataKeys(this.data[0]),this.checkContent(this.data)),this.storageDgData=this.data.slice(0),this.pages=[],this.lastChild=null,this.realCountRecords=this.data.length}renderPages(t,e){return this.pages=this.dataPagination(t),this.renderData(e)}renderData(t,e=!1){const s=this.pages[t-1]||[];return this.container.innerHTML=e?this.container.innerHTML+this.dataRenderFn(s):this.dataRenderFn(s),this.childSelector&&(this.lastChild=this.getLastChild()),Promise.resolve(this.lastChild)}reduceNumberEntries(t=null){Number.isFinite(t)&&(this.data.length=t,this.storageDgData.length=t,this.realCountRecords=t)}dataPagination(t){let e=[];for(let s=0,i=this.data.length,r=+t;s<i;s+=r){let t=this.data.slice(s,s+r);e=[...e,t]}return e}}class d extends l{constructor(t){super(t)}sortData(t={}){t.field&&(t.direction||(t.direction=1),t.type||(t.type="alpha"),this.lastSortQuery=t,this.data.sort(((e,s)=>i(e,s,t))))}filterData(t={}){if(!t)return void console.warn("%csearch data is empty!","font-size:16px;");const{q:e,...s}=t,r=e?.value?.toLowerCase(),n=Object.keys(s);r||n.length?(this.data=this.storageDgData.filter((t=>!!(r?Object.values(t).find((t=>String(t).toLowerCase().includes(r))):t)&&(!n.length||n.every((e=>{const i=s[e];return!!t[e]&&a(t[e],i)}))))),this.lastSortQuery&&this.data.sort(((t,e)=>i(t,e,this.lastSortQuery))),this.realCountRecords=this.data.length):console.warn("%cSearch values are not set!","font-size:16px;")}restoreData(){this.data=[...this.storageDgData],this.lastSortQuery&&this.data.sort(((t,e)=>i(t,e,this.lastSortQuery))),this.realCountRecords=this.data.length}}class c extends h{constructor({url:t,urlParams:e,...s}){if(super(s),!e)throw new Error("`urlParams` property must be defined!");if(!e.pageNumber)throw new Error("`urlParams.pageNumber` property must be defined!");this.url=t,this.urlBasic=this.url,this.urlParams=e,this.urlExtraParams=s.urlExtraParams,this.dimmerElement=document.querySelector(s.dimmerSelector),this.lastChild=null,this.urlExtraParams&&this.setUrlQuery(this.urlExtraParams)}renderPages(t,e){return(this.urlParams.limit&&this.limitData!==t||!this.limitData)&&this.setUrlQuery({[`${this.urlParams.limit}`]:t}),this.limitData=t,this.renderData(e)}loadServerData(){return this.realCountRecords=null,fetch(this.url).then((t=>{if(this.realCountRecords=t.headers.get("x-total-count")?+t.headers.get("x-total-count"):null,null===this.realCountRecords)throw new Error("Response header 'X-Total-Count' doesn't exist,\n so the total number of entries is undefined!\n Check also URL parameters.");return t.json()}))}renderData(t,e=!1){return this.toggleDimmer(!0),this.setUrlQuery({[`${this.urlParams.pageNumber}`]:t}),this.loadServerData().then((t=>(!this.dataKeys&&t.length&&this.setDataKeys(t[0]),this.displayData(t,e),this.toggleDimmer(!1),this.childSelector&&(this.lastChild=this.getLastChild()),this.lastChild))).catch((t=>{throw this.toggleDimmer(!1),t}))}displayData(t=[],e=!1){this.checkContent(t),this.container.innerHTML=e?this.container.innerHTML+this.dataRenderFn(t):this.dataRenderFn(t)}getQueryParams(){const t=new URL(`${this.url}`);return new URLSearchParams(t.search)}setUrlQuery(t={}){const e=this.setQueryParams(t);this.setUrl(e)}setQueryParams(t={}){let e=this.getQueryParams();return Object.entries(t).forEach((([t,s])=>{e.set(t,s)})),e}removeQueryParams(t={}){let e=this.getQueryParams();Object.keys(t).forEach((t=>{e.delete(t)})),this.setUrl(e)}setUrl(t){this.url=`${this.urlBasic}?${t.toString()}`}toggleDimmer(t){this.dimmerElement&&(t?(this.dimmerElement.classList.add("active"),this.container.style.opacity=.7):(this.dimmerElement.classList.remove("active"),this.container.style.opacity=1))}}class u extends c{constructor(t){super(t),this.lastSearch={}}sortData(t={}){this.setUrlQuery(t)}filterData(t={}){Object.keys(this.lastSearch).length&&this.removeQueryParams(this.lastSearch),this.lastSearch=t,this.setUrlQuery(t)}restoreData(){this.lastSearch&&this.removeQueryParams(this.lastSearch)}}return class extends class{constructor(e){const{dataOptions:s,pagingOptions:i}=this.setOptions(e);this.dataControl=function(t){if(!t.data&&!t.url)throw new Error("The `url` or `data` property must be defined!");return t.data?new d(t):new u(t)}(s),this.pagingControl=new t(i),this.pagingControl.initCountRecords&&this.pagingControl.initCountRecords<this.dataControl.realCountRecords&&this.dataControl.reduceNumberEntries(this.pagingControl.initCountRecords),this.init()}setOptions(t){let e={perPage:10,countRecords:null,isShowPerPage:!0,loading:"none",textShowMore:null,...t||{}};const{dataOptions:s,pagingOptions:i}=(({pagingContainer:t,perPage:e,countRecords:s,isShowPerPage:i,loading:r,textShowMore:n,dataContainer:a,...o})=>({pagingOptions:{container:t,perPage:e,countRecords:s,isShowPerPage:i,loading:r,textShowMore:n},dataOptions:{container:a,...o}}))(e);return s.urlParams&&!s.urlParams.limit&&(i.isShowPerPage=!1),{dataOptions:s,pagingOptions:i}}init(){this.checkMethods(),this.pagingControl.subscribe("renderPages",this.renderPages.bind(this)),this.pagingControl.subscribe("renderData",this.renderData.bind(this)),this.pagingControl.subscribe("goToTop",this.goToTop.bind(this)),this.initialized=this.pagingControl.init()}checkMethods(){const t=["renderPages","renderData"];for(const e of t)if("function"!=typeof this.dataControl[e])throw new Error(`${e} method should be implemented! in Data class`)}renderPages(t=10,e=1){return this.dataControl.renderPages(t,e).then((t=>({lastChild:t,countRecords:this.dataControl.realCountRecords??null})))}renderData(t=1,e=!1){return this.dataControl.renderData(t,e).then((t=>({lastChild:t})))}goToTop(){"function"==typeof this.dataControl.goToTop&&this.dataControl.goToTop()}}{constructor(t){super(t)}getDataKeys(){return this.initialized.then((()=>this.dataControl.dataKeys||[]))}getNumPage(){return this.pagingControl.numPage}getPerPage(){return this.pagingControl.perPage}render(t=1){return this.pagingControl.numPage=t,this.pagingControl.renderDataPagination()}sortData(t={},e=1){this.dataControl.sortData(t),this.render(e)}filterData(t={}){return this.dataControl.filterData(t),this.render(1).then((()=>this.pagingControl.countRecords))}restoreData(){return this.dataControl.restoreData(),this.render(1)}}}));
